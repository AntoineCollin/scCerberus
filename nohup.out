test_obs=donor1
train_obs=donor2
2024-04-03 09:21:06.598361: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-04-03 09:21:06.670438: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2024-04-03 09:21:06.670503: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2024-04-03 09:21:06.672192: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2024-04-03 09:21:06.683112: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: SSE4.1 SSE4.2 AVX AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
tf [PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]
tf [PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/metadata
[INFO 04-03 09:21:17] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the `verbose_logging` argument to `False`. Note that float values in the logs are rounded to 6 decimal points.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter use_hvg. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter batch_size. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter clas_w. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter dann_w. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter learning_rate. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter weight_decay. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter warmup_epoch. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter dropout. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter bottleneck. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter layer2. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter layer1. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 09:21:17] ax.service.utils.instantiation: Created search space: SearchSpace(parameters=[RangeParameter(name='use_hvg', parameter_type=INT, range=[500, 1000]), RangeParameter(name='batch_size', parameter_type=INT, range=[64, 512]), RangeParameter(name='clas_w', parameter_type=FLOAT, range=[0.0001, 100.0], log_scale=True), RangeParameter(name='dann_w', parameter_type=FLOAT, range=[0.0001, 100.0], log_scale=True), RangeParameter(name='learning_rate', parameter_type=FLOAT, range=[0.0001, 0.01], log_scale=True), RangeParameter(name='weight_decay', parameter_type=FLOAT, range=[1e-08, 0.0001], log_scale=True), RangeParameter(name='warmup_epoch', parameter_type=INT, range=[10, 20]), RangeParameter(name='dropout', parameter_type=FLOAT, range=[0.0, 0.5]), RangeParameter(name='bottleneck', parameter_type=INT, range=[32, 64]), RangeParameter(name='layer2', parameter_type=INT, range=[64, 512]), RangeParameter(name='layer1', parameter_type=INT, range=[512, 2048])], parameter_constraints=[]).
[INFO 04-03 09:21:17] ax.modelbridge.dispatch_utils: Using Models.BOTORCH_MODULAR since there is at least one ordered parameter and there are no unordered categorical parameters.
[INFO 04-03 09:21:17] ax.modelbridge.dispatch_utils: Calculating the number of remaining initialization trials based on num_initialization_trials=None max_initialization_trials=None num_tunable_parameters=11 num_trials=None use_batch_trials=False
[INFO 04-03 09:21:17] ax.modelbridge.dispatch_utils: calculated num_initialization_trials=22
[INFO 04-03 09:21:17] ax.modelbridge.dispatch_utils: num_completed_initialization_trials=0 num_remaining_initialization_trials=22
[INFO 04-03 09:21:17] ax.modelbridge.dispatch_utils: `verbose`, `disable_progbar`, and `jit_compile` are not yet supported when using `choose_generation_strategy` with ModularBoTorchModel, dropping these arguments.
[INFO 04-03 09:21:17] ax.modelbridge.dispatch_utils: Using Bayesian Optimization generation strategy: GenerationStrategy(name='Sobol+BoTorch', steps=[Sobol for 22 trials, BoTorch for subsequent trials]). Iterations after 22 will take longer to generate due to model-fitting.
[INFO 04-03 09:21:17] ax.service.ax_client: Generated new trial 0 with parameters {'use_hvg': 976, 'batch_size': 109, 'clas_w': 0.000164, 'dann_w': 0.127036, 'learning_rate': 0.001427, 'weight_decay': 0.0, 'warmup_epoch': 20, 'dropout': 0.438763, 'bottleneck': 42, 'layer2': 478, 'layer1': 1373} using model Sobol.
2024-04-03 09:21:17.490290: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1929] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 38362 MB memory:  -> device: 0, name: NVIDIA A100-PCIE-40GB, pci bus id: 0000:37:00.0, compute capability: 8.0
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-354
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
[neptune] [warning] /home/becavin/scPermut/scpermut/workflow/optimize_hp.py:589: NeptuneUnsupportedType: You're attempting to log a type that is not directly supported by Neptune (<class 'list'>).
        Convert the value to a supported type, such as a string or float, or use stringify_unsupported(obj)
        for dictionaries or collections that contain unsupported values.
        For more, see https://docs.neptune.ai/help/value_of_unsupported_type
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 528 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 300 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 744 highly variable genes using 1 batches. Selecting top 148
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 976
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
WARMUPDANNNNNNNN 20
COMPLETE 50
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
82087326
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
17832183
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
72344207
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
30446052
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
33407974
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
20241355
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
44465065
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
63844490
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
24469184
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
83517265
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
45579147
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
52185821
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
59382629
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
17993164
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
88462829
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
15671157
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
25942420
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
61305809
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
34910011
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
80004119
Strategy duration : 593.719179391861 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
28961944
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
4156303
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
94939804
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
73281860
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
88889503
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
81592369
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
48103713
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
29816627
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
64468383
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
86050033
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
58196640
Epoch 32/70, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
98861122
Epoch 33/70, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
14718055
Epoch 34/70, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
97843170
Epoch 35/70, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
85184478
Epoch 36/70, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
1576614
Epoch 37/70, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
23784065
Epoch 38/70, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
19753265
Epoch 39/70, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
16438293
Epoch 40/70, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
33493423
Epoch 41/70, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
61852264
Epoch 42/70, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
21593475
Early stopping at epoch 12, restoring model parameters from this epoch
Strategy duration : 293.7013728618622 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.3921387486690214
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-354/metadata
[INFO 04-03 09:37:56] ax.service.ax_client: Completed trial 0 with data: {'opt_metric': (0.392139, None)}.
[INFO 04-03 09:37:56] ax.service.ax_client: Generated new trial 1 with parameters {'use_hvg': 545, 'batch_size': 226, 'clas_w': 0.000775, 'dann_w': 0.156967, 'learning_rate': 0.002754, 'weight_decay': 0.0, 'warmup_epoch': 19, 'dropout': 0.370637, 'bottleneck': 57, 'layer2': 506, 'layer1': 1658} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-355
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 256 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 213 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 441 highly variable genes using 1 batches. Selecting top 76
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 545
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
25786399
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
83526229
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
70743560
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
83623123
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
39634132
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
76325035
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
89173698
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
46637153
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
38356781
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
8332252
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
78175735
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
7859802
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
49119949
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
29589653
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
41518020
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
55144882
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
30307388
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
59743690
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
81748771
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
39155387
Strategy duration : 309.39605045318604 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
64705276
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
81332778
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
48843765
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
70972824
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
89378929
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
24979591
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
801658
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
52286720
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
32395744
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
88981056
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
47852706
Early stopping at epoch 1, restoring model parameters from this epoch
Strategy duration : 92.1349606513977 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.11353775456113367
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-355/metadata
[INFO 04-03 09:45:42] ax.service.ax_client: Completed trial 1 with data: {'opt_metric': (0.113538, None)}.
[INFO 04-03 09:45:42] ax.service.ax_client: Generated new trial 2 with parameters {'use_hvg': 801, 'batch_size': 164, 'clas_w': 5.399157, 'dann_w': 0.096867, 'learning_rate': 0.003077, 'weight_decay': 4e-06, 'warmup_epoch': 18, 'dropout': 0.135741, 'bottleneck': 59, 'layer2': 84, 'layer1': 1282} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-356
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/plotting/_tools/scatterplots.py:250: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`). Consider using `matplotlib.pyplot.close()`.
  fig = plt.figure()
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 413 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 263 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 638 highly variable genes using 1 batches. Selecting top 125
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 801
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
76855468
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
54140090
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
19383239
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
1240921
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
50243186
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
15939903
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
65188026
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
12914085
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
81406784
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
6209945
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
39764213
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
25943183
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
79990386
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
53870010
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
1218414
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
45249557
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
5186271
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
46263694
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
45750808
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
50163269
Strategy duration : 413.2333197593689 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
99518394
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
87629508
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
30729484
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
91351699
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
34498977
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
41851615
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
61592292
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
3771591
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
40965843
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
93312454
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
16116333
Epoch 32/70, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
50721740
Epoch 33/70, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
6860733
Epoch 34/70, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
67822074
Epoch 35/70, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
44849205
Epoch 36/70, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
61189651
Epoch 37/70, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
11081695
Epoch 38/70, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
27605438
Epoch 39/70, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
31371879
Epoch 40/70, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
32344436
Epoch 41/70, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
25338172
Epoch 42/70, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
77272415
Epoch 43/70, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
84222221
Early stopping at epoch 13, restoring model parameters from this epoch
Strategy duration : 238.24409699440002 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.8094789913085568
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-356/metadata
[INFO 04-03 09:57:27] ax.service.ax_client: Completed trial 2 with data: {'opt_metric': (0.809479, None)}.
[INFO 04-03 09:57:27] ax.service.ax_client: Generated new trial 3 with parameters {'use_hvg': 635, 'batch_size': 201, 'clas_w': 1.40617, 'dann_w': 0.740503, 'learning_rate': 0.004749, 'weight_decay': 0.0, 'warmup_epoch': 11, 'dropout': 0.127582, 'bottleneck': 50, 'layer2': 441, 'layer1': 1383} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-357
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 317 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 222 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 510 highly variable genes using 1 batches. Selecting top 96
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 635
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
57299995
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
90822029
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
50135040
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
81574249
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
11921691
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
77042770
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
98233795
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
39846229
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
52232933
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
5774307
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
44845962
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
3182220
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
8345794
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
35303688
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
66308975
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
99958992
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
18332481
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
76104545
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
59941482
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
46986007
Strategy duration : 381.4887526035309 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
7552909
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
95746994
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
88038253
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
83332633
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
39271354
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
7299423
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
62896156
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
1119804
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
94937133
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
91968154
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
18294906
Epoch 32/70, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
20309638
Epoch 33/70, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
24072074
Epoch 34/70, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
21408462
Epoch 35/70, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
36445617
Epoch 36/70, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
97241210
Epoch 37/70, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
77956962
Epoch 38/70, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
67289543
Epoch 39/70, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
75888633
Epoch 40/70, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
68791770
Epoch 41/70, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
4330062
Epoch 42/70, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
70519065
Epoch 43/70, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
8721923
Early stopping at epoch 13, restoring model parameters from this epoch
Strategy duration : 205.08099126815796 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.8286941633888705
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-357/metadata
[INFO 04-03 10:08:10] ax.service.ax_client: Completed trial 3 with data: {'opt_metric': (0.828694, None)}.
[INFO 04-03 10:08:10] ax.service.ax_client: Generated new trial 4 with parameters {'use_hvg': 855, 'batch_size': 475, 'clas_w': 0.005137, 'dann_w': 21.101681, 'learning_rate': 0.006838, 'weight_decay': 4e-06, 'warmup_epoch': 14, 'dropout': 0.01993, 'bottleneck': 63, 'layer2': 507, 'layer1': 821} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-358
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 447 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 282 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 660 highly variable genes using 1 batches. Selecting top 126
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 855
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
57839584
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
73389816
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
69861793
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
87199020
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
18602943
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
93599128
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
22651863
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
3731155
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
93527984
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
39394760
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
3830909
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
278854
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
34948921
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
3339767
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
52735328
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
22879219
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
73800277
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
65441131
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
41515731
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
20304870
Strategy duration : 193.2900915145874 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
90686225
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
30239868
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
7060623
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
25721549
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
53321456
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
71710777
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
23253250
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
9854507
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
77687644
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
42515945
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
22666931
Early stopping at epoch 1, restoring model parameters from this epoch
Strategy duration : 54.75694489479065 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.3307443037076167
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-358/metadata
[INFO 04-03 10:13:19] ax.service.ax_client: Completed trial 4 with data: {'opt_metric': (0.330744, None)}.
[INFO 04-03 10:13:19] ax.service.ax_client: Generated new trial 5 with parameters {'use_hvg': 953, 'batch_size': 326, 'clas_w': 0.000385, 'dann_w': 0.060573, 'learning_rate': 0.000153, 'weight_decay': 0.0, 'warmup_epoch': 20, 'dropout': 0.301578, 'bottleneck': 55, 'layer2': 389, 'layer1': 647} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-359
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 514 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 299 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 719 highly variable genes using 1 batches. Selecting top 140
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 953
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
50131607
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
90497589
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
24404335
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
13734817
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
42588996
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
25085830
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
60326385
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
29916572
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
97738075
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
80787086
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
45989227
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
67307662
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
7879829
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
92167663
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
43320465
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
73663139
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
14596557
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
75763511
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
3460502
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
74010467
Strategy duration : 245.83243370056152 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
46450996
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
14552688
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
58998489
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
49336242
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
32318305
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
92073059
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
35124206
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
78573226
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
23357391
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
86417579
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
41520690
Epoch 32/70, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
66398811
Epoch 33/70, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
67866897
Epoch 34/70, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
39346313
Epoch 35/70, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
6319046
Epoch 36/70, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
80044937
Epoch 37/70, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
47016525
Epoch 38/70, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
66599273
Epoch 39/70, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
1969146
Epoch 40/70, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
29610824
Epoch 41/70, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
71122741
Epoch 42/70, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
44949913
Epoch 43/70, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
82522010
Epoch 44/70, Current strat Epoch 24/50
Step - Switching permutation
Step - Switching permutation
13196945
Early stopping at epoch 14, restoring model parameters from this epoch
Strategy duration : 140.05776262283325 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.35984450756116193
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-359/metadata
[INFO 04-03 10:20:50] ax.service.ax_client: Completed trial 5 with data: {'opt_metric': (0.359845, None)}.
[INFO 04-03 10:20:50] ax.service.ax_client: Generated new trial 6 with parameters {'use_hvg': 756, 'batch_size': 296, 'clas_w': 0.441424, 'dann_w': 0.051973, 'learning_rate': 0.005068, 'weight_decay': 0.0, 'warmup_epoch': 17, 'dropout': 0.071791, 'bottleneck': 39, 'layer2': 329, 'layer1': 1808} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-360
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 388 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 250 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 604 highly variable genes using 1 batches. Selecting top 118
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 756
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 20 epochs
Epoch 1/70, Current strat Epoch 1/20
Step - Switching permutation
Step - Switching permutation
16604804
Epoch 2/70, Current strat Epoch 2/20
Step - Switching permutation
Step - Switching permutation
43787384
Epoch 3/70, Current strat Epoch 3/20
Step - Switching permutation
Step - Switching permutation
49526214
Epoch 4/70, Current strat Epoch 4/20
Step - Switching permutation
Step - Switching permutation
57690238
Epoch 5/70, Current strat Epoch 5/20
Step - Switching permutation
Step - Switching permutation
29343032
Epoch 6/70, Current strat Epoch 6/20
Step - Switching permutation
Step - Switching permutation
29274940
Epoch 7/70, Current strat Epoch 7/20
Step - Switching permutation
Step - Switching permutation
57146453
Epoch 8/70, Current strat Epoch 8/20
Step - Switching permutation
Step - Switching permutation
17634963
Epoch 9/70, Current strat Epoch 9/20
Step - Switching permutation
Step - Switching permutation
63032531
Epoch 10/70, Current strat Epoch 10/20
Step - Switching permutation
Step - Switching permutation
66750717
Epoch 11/70, Current strat Epoch 11/20
Step - Switching permutation
Step - Switching permutation
46768951
Epoch 12/70, Current strat Epoch 12/20
Step - Switching permutation
Step - Switching permutation
20250892
Epoch 13/70, Current strat Epoch 13/20
Step - Switching permutation
Step - Switching permutation
14262199
Epoch 14/70, Current strat Epoch 14/20
Step - Switching permutation
Step - Switching permutation
39766311
Epoch 15/70, Current strat Epoch 15/20
Step - Switching permutation
Step - Switching permutation
3517723
Epoch 16/70, Current strat Epoch 16/20
Step - Switching permutation
Step - Switching permutation
91583633
Epoch 17/70, Current strat Epoch 17/20
Step - Switching permutation
Step - Switching permutation
88032722
Epoch 18/70, Current strat Epoch 18/20
Step - Switching permutation
Step - Switching permutation
99021720
Epoch 19/70, Current strat Epoch 19/20
Step - Switching permutation
Step - Switching permutation
96969795
Epoch 20/70, Current strat Epoch 20/20
Step - Switching permutation
Step - Switching permutation
58109664
Strategy duration : 263.97569584846497 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 21/70, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
54000091
Epoch 22/70, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
79227066
Epoch 23/70, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
66297912
Epoch 24/70, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
71010971
Epoch 25/70, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
17275428
Epoch 26/70, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
83328056
Epoch 27/70, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
83094024
Epoch 28/70, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
11085319
Epoch 29/70, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
92988395
Epoch 30/70, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
78454399
Epoch 31/70, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
36928558
Epoch 32/70, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
22162246
Epoch 33/70, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
44195556
Epoch 34/70, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
23015022
Epoch 35/70, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
75505828
Epoch 36/70, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
92646980
Epoch 37/70, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
39008903
Epoch 38/70, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
28503036
Epoch 39/70, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
29382896
Epoch 40/70, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
84886550
Epoch 41/70, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
36254501
Epoch 42/70, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
5059051
Early stopping at epoch 12, restoring model parameters from this epoch
Strategy duration : 150.56093335151672 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.8224189376583203
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-360/metadata
[INFO 04-03 10:28:48] ax.service.ax_client: Completed trial 6 with data: {'opt_metric': (0.822419, None)}.
[INFO 04-03 10:28:48] ax.service.ax_client: Generated new trial 7 with parameters {'use_hvg': 742, 'batch_size': 439, 'clas_w': 0.980649, 'dann_w': 33.751875, 'learning_rate': 0.000616, 'weight_decay': 4e-05, 'warmup_epoch': 11, 'dropout': 0.470265, 'bottleneck': 35, 'layer2': 80, 'layer1': 1119} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-361
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
test_obs=donor1
train_obs=donor2
2024-04-03 10:36:56.690221: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-04-03 10:36:56.742931: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2024-04-03 10:36:56.743020: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2024-04-03 10:36:56.744498: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2024-04-03 10:36:56.753978: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: SSE4.1 SSE4.2 AVX AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
tf [PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]
tf [PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/metadata
[INFO 04-03 10:37:09] ax.service.ax_client: Starting optimization with verbose logging. To disable logging, set the `verbose_logging` argument to `False`. Note that float values in the logs are rounded to 6 decimal points.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter use_hvg. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter batch_size. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter clas_w. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter dann_w. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter learning_rate. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter weight_decay. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter warmup_epoch. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.FLOAT for parameter dropout. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter bottleneck. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter layer2. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Inferred value type of ParameterType.INT for parameter layer1. If that is not the expected value type, you can explicitly specify 'value_type' ('int', 'float', 'bool' or 'str') in parameter dict.
[INFO 04-03 10:37:09] ax.service.utils.instantiation: Created search space: SearchSpace(parameters=[RangeParameter(name='use_hvg', parameter_type=INT, range=[500, 1000]), RangeParameter(name='batch_size', parameter_type=INT, range=[64, 512]), RangeParameter(name='clas_w', parameter_type=FLOAT, range=[0.0001, 100.0], log_scale=True), RangeParameter(name='dann_w', parameter_type=FLOAT, range=[0.0001, 100.0], log_scale=True), RangeParameter(name='learning_rate', parameter_type=FLOAT, range=[0.0001, 0.01], log_scale=True), RangeParameter(name='weight_decay', parameter_type=FLOAT, range=[1e-08, 0.0001], log_scale=True), RangeParameter(name='warmup_epoch', parameter_type=INT, range=[10, 20]), RangeParameter(name='dropout', parameter_type=FLOAT, range=[0.0, 0.5]), RangeParameter(name='bottleneck', parameter_type=INT, range=[32, 64]), RangeParameter(name='layer2', parameter_type=INT, range=[64, 512]), RangeParameter(name='layer1', parameter_type=INT, range=[512, 2048])], parameter_constraints=[]).
[INFO 04-03 10:37:09] ax.modelbridge.dispatch_utils: Using Models.BOTORCH_MODULAR since there is at least one ordered parameter and there are no unordered categorical parameters.
[INFO 04-03 10:37:09] ax.modelbridge.dispatch_utils: Calculating the number of remaining initialization trials based on num_initialization_trials=None max_initialization_trials=None num_tunable_parameters=11 num_trials=None use_batch_trials=False
[INFO 04-03 10:37:09] ax.modelbridge.dispatch_utils: calculated num_initialization_trials=22
[INFO 04-03 10:37:09] ax.modelbridge.dispatch_utils: num_completed_initialization_trials=0 num_remaining_initialization_trials=22
[INFO 04-03 10:37:09] ax.modelbridge.dispatch_utils: `verbose`, `disable_progbar`, and `jit_compile` are not yet supported when using `choose_generation_strategy` with ModularBoTorchModel, dropping these arguments.
[INFO 04-03 10:37:09] ax.modelbridge.dispatch_utils: Using Bayesian Optimization generation strategy: GenerationStrategy(name='Sobol+BoTorch', steps=[Sobol for 22 trials, BoTorch for subsequent trials]). Iterations after 22 will take longer to generate due to model-fitting.
[INFO 04-03 10:37:09] ax.service.ax_client: Generated new trial 0 with parameters {'use_hvg': 966, 'batch_size': 512, 'clas_w': 16.247684, 'dann_w': 46.259311, 'learning_rate': 0.00981, 'weight_decay': 1e-06, 'warmup_epoch': 12, 'dropout': 0.432933, 'bottleneck': 52, 'layer2': 112, 'layer1': 1605} using model Sobol.
2024-04-03 10:37:09.439021: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1929] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 38362 MB memory:  -> device: 0, name: NVIDIA A100-PCIE-40GB, pci bus id: 0000:37:00.0, compute capability: 8.0
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-362
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
[neptune] [warning] /home/becavin/scPermut/scpermut/workflow/optimize_hp.py:592: NeptuneUnsupportedType: You're attempting to log a type that is not directly supported by Neptune (<class 'list'>).
        Convert the value to a supported type, such as a string or float, or use stringify_unsupported(obj)
        for dictionaries or collections that contain unsupported values.
        For more, see https://docs.neptune.ai/help/value_of_unsupported_type
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 523 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 297 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 735 highly variable genes using 1 batches. Selecting top 146
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 966
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
WARMUPDANNNNNNNN 12
COMPLETE 50
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
1418113
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
45786666
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
42066192
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
33896636
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
14821243
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
3217315
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
77108764
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
14739990
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
3715896
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
39434814
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
70602035
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
54637908
Strategy duration : 101.27034401893616 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
78697204
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
68157958
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
95995712
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
93094253
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
72165870
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
79710006
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
53935813
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
18140220
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
8112335
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
79912185
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
98283004
Early stopping at epoch 1, restoring model parameters from this epoch
Strategy duration : 51.852099657058716 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.2966215184355635
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-362/metadata
[INFO 04-03 10:41:37] ax.service.ax_client: Completed trial 0 with data: {'opt_metric': (0.296622, None)}.
[INFO 04-03 10:41:37] ax.service.ax_client: Generated new trial 1 with parameters {'use_hvg': 679, 'batch_size': 274, 'clas_w': 0.00011, 'dann_w': 56.390197, 'learning_rate': 0.006884, 'weight_decay': 4e-06, 'warmup_epoch': 15, 'dropout': 0.049207, 'bottleneck': 54, 'layer2': 254, 'layer1': 961} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-363
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 340 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 237 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 543 highly variable genes using 1 batches. Selecting top 102
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 679
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
33914184
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
47596931
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
3246307
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
5963897
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
9562301
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
87438583
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
34769248
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
39717864
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
75189208
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
68305778
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
79474067
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
90755844
Strategy duration : 168.75373005867004 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
21554183
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
12498855
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
20674514
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
97309494
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
7048797
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
3788566
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
42115020
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
4358673
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
2906417
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
14723587
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
64079475
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
71066284
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
89133262
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
39894676
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
85676765
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
73647499
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
94726562
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
43291664
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
64411544
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
51297950
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
27783203
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
9781265
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
12312316
Early stopping at epoch 13, restoring model parameters from this epoch
Strategy duration : 102.71760559082031 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.3937855342886976
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-363/metadata
[INFO 04-03 10:46:42] ax.service.ax_client: Completed trial 1 with data: {'opt_metric': (0.393786, None)}.
[INFO 04-03 10:46:42] ax.service.ax_client: Generated new trial 2 with parameters {'use_hvg': 709, 'batch_size': 331, 'clas_w': 0.025768, 'dann_w': 0.000143, 'learning_rate': 0.002418, 'weight_decay': 7.6e-05, 'warmup_epoch': 13, 'dropout': 0.417116, 'bottleneck': 57, 'layer2': 363, 'layer1': 810} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-364
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/plotting/_tools/scatterplots.py:250: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`). Consider using `matplotlib.pyplot.close()`.
  fig = plt.figure()
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 354 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 251 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 563 highly variable genes using 1 batches. Selecting top 104
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 709
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
159072
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
94408226
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
64396667
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
39905548
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
5514144
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
49506187
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
93862533
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
66791343
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
65382766
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
5042076
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
56695747
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
15333938
Strategy duration : 66.37456250190735 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
67214584
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
34519767
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
48657035
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
31913948
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
41026306
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
59287261
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
17618942
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
33725738
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
10506057
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
2419471
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
2375411
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
1166915
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
9249877
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
72341346
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
57074928
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
59724235
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
28287887
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
15067291
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
83247947
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
93452262
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
71255493
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
2828598
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
35754776
Epoch 36/62, Current strat Epoch 24/50
Step - Switching permutation
Step - Switching permutation
15486145
Epoch 37/62, Current strat Epoch 25/50
Step - Switching permutation
Step - Switching permutation
76685142
Epoch 38/62, Current strat Epoch 26/50
Step - Switching permutation
Step - Switching permutation
34005737
Epoch 39/62, Current strat Epoch 27/50
Step - Switching permutation
Step - Switching permutation
93255424
Epoch 40/62, Current strat Epoch 28/50
Step - Switching permutation
Step - Switching permutation
85586357
Epoch 41/62, Current strat Epoch 29/50
Step - Switching permutation
Step - Switching permutation
4731941
Epoch 42/62, Current strat Epoch 30/50
Step - Switching permutation
Step - Switching permutation
65833282
Epoch 43/62, Current strat Epoch 31/50
Step - Switching permutation
Step - Switching permutation
37417030
Early stopping at epoch 21, restoring model parameters from this epoch
Strategy duration : 90.75155377388 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.8067717856429468
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-364/metadata
[INFO 04-03 10:49:48] ax.service.ax_client: Completed trial 2 with data: {'opt_metric': (0.806772, None)}.
[INFO 04-03 10:49:48] ax.service.ax_client: Generated new trial 3 with parameters {'use_hvg': 873, 'batch_size': 436, 'clas_w': 0.35966, 'dann_w': 1.385129, 'learning_rate': 0.000621, 'weight_decay': 1e-06, 'warmup_epoch': 10, 'dropout': 0.023214, 'bottleneck': 52, 'layer2': 455, 'layer1': 954} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-365
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 458 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 288 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 669 highly variable genes using 1 batches. Selecting top 127
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 873
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
12179756
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
61556434
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
47894668
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
19190597
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
9460067
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
72690582
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
83697700
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
88849639
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
41106414
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
85161399
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
97106170
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
59495544
Strategy duration : 56.35298299789429 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Early stopping at epoch 3, restoring model parameters from this epoch
Strategy duration : 23.765883207321167 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.43459468100258636
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-365/metadata
[INFO 04-03 10:51:38] ax.service.ax_client: Completed trial 3 with data: {'opt_metric': (0.434595, None)}.
[INFO 04-03 10:51:38] ax.service.ax_client: Generated new trial 4 with parameters {'use_hvg': 577, 'batch_size': 500, 'clas_w': 1.262265, 'dann_w': 33.49395, 'learning_rate': 0.000334, 'weight_decay': 1e-06, 'warmup_epoch': 17, 'dropout': 0.449553, 'bottleneck': 59, 'layer2': 416, 'layer1': 1309} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-366
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 277 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 213 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 474 highly variable genes using 1 batches. Selecting top 87
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 577
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
86274719
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
27775382
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
27405548
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
84237670
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
17618942
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
63154029
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
73110580
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
91336250
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
5234909
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
68445968
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
84107589
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
83199691
Strategy duration : 49.871227979660034 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Epoch 36/62, Current strat Epoch 24/50
Step - Switching permutation
Epoch 37/62, Current strat Epoch 25/50
Step - Switching permutation
Epoch 38/62, Current strat Epoch 26/50
Step - Switching permutation
Epoch 39/62, Current strat Epoch 27/50
Step - Switching permutation
Epoch 40/62, Current strat Epoch 28/50
Step - Switching permutation
Epoch 41/62, Current strat Epoch 29/50
Step - Switching permutation
Epoch 42/62, Current strat Epoch 30/50
Step - Switching permutation
Epoch 43/62, Current strat Epoch 31/50
Step - Switching permutation
Epoch 44/62, Current strat Epoch 32/50
Step - Switching permutation
Epoch 45/62, Current strat Epoch 33/50
Step - Switching permutation
Epoch 46/62, Current strat Epoch 34/50
Step - Switching permutation
Epoch 47/62, Current strat Epoch 35/50
Step - Switching permutation
Epoch 48/62, Current strat Epoch 36/50
Step - Switching permutation
Epoch 49/62, Current strat Epoch 37/50
Step - Switching permutation
Epoch 50/62, Current strat Epoch 38/50
Step - Switching permutation
Epoch 51/62, Current strat Epoch 39/50
Step - Switching permutation
Epoch 52/62, Current strat Epoch 40/50
Step - Switching permutation
Epoch 53/62, Current strat Epoch 41/50
Step - Switching permutation
Epoch 54/62, Current strat Epoch 42/50
Step - Switching permutation
Epoch 55/62, Current strat Epoch 43/50
Step - Switching permutation
Epoch 56/62, Current strat Epoch 44/50
Step - Switching permutation
Epoch 57/62, Current strat Epoch 45/50
Step - Switching permutation
Epoch 58/62, Current strat Epoch 46/50
Step - Switching permutation
Epoch 59/62, Current strat Epoch 47/50
Step - Switching permutation
Epoch 60/62, Current strat Epoch 48/50
Step - Switching permutation
Epoch 61/62, Current strat Epoch 49/50
Step - Switching permutation
Epoch 62/62, Current strat Epoch 50/50
Step - Switching permutation
Strategy duration : 82.18534064292908 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.3484392022038824
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-366/metadata
[INFO 04-03 10:54:19] ax.service.ax_client: Completed trial 4 with data: {'opt_metric': (0.348439, None)}.
[INFO 04-03 10:54:19] ax.service.ax_client: Generated new trial 5 with parameters {'use_hvg': 661, 'batch_size': 150, 'clas_w': 0.324702, 'dann_w': 20.180874, 'learning_rate': 0.000155, 'weight_decay': 9e-06, 'warmup_epoch': 17, 'dropout': 0.295376, 'bottleneck': 39, 'layer2': 489, 'layer1': 1302} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-367
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 330 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 230 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 533 highly variable genes using 1 batches. Selecting top 101
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 661
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
57817077
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
97126388
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
97590065
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
70064163
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
82137680
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
94192886
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
54222488
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
6726264
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
56412124
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
92612648
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
41953468
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
45177841
Strategy duration : 134.73525071144104 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
6066322
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
20428657
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
75030899
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
13488197
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
26538848
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
99464988
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
98541259
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
76456260
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
72649955
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
49320602
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
3943252
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
59608650
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
33104324
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
599670
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
91182708
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
94339370
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
5262756
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
79306983
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
33069419
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
47652053
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
36406898
Early stopping at epoch 11, restoring model parameters from this epoch
Strategy duration : 120.82936072349548 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.38659275158452827
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-367/metadata
[INFO 04-03 10:59:04] ax.service.ax_client: Completed trial 5 with data: {'opt_metric': (0.386593, None)}.
[INFO 04-03 10:59:04] ax.service.ax_client: Generated new trial 6 with parameters {'use_hvg': 785, 'batch_size': 441, 'clas_w': 0.200553, 'dann_w': 0.066992, 'learning_rate': 0.006329, 'weight_decay': 0.0, 'warmup_epoch': 10, 'dropout': 0.260003, 'bottleneck': 43, 'layer2': 140, 'layer1': 992} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-368
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 403 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 258 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 630 highly variable genes using 1 batches. Selecting top 124
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 785
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
12391281
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
65784454
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
29831695
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
11977386
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
3835105
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
58160781
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
33559226
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
93096923
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
30311393
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
68920898
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
33212661
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
65788650
Strategy duration : 57.73338174819946 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Epoch 36/62, Current strat Epoch 24/50
Step - Switching permutation
Early stopping at epoch 14, restoring model parameters from this epoch
Strategy duration : 44.27452802658081 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.4922728079295017
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 11 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 11 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-368/metadata
[INFO 04-03 11:01:16] ax.service.ax_client: Completed trial 6 with data: {'opt_metric': (0.492273, None)}.
[INFO 04-03 11:01:16] ax.service.ax_client: Generated new trial 7 with parameters {'use_hvg': 922, 'batch_size': 147, 'clas_w': 0.001229, 'dann_w': 0.58957, 'learning_rate': 0.004014, 'weight_decay': 1e-05, 'warmup_epoch': 12, 'dropout': 0.029839, 'bottleneck': 59, 'layer2': 113, 'layer1': 1513} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-369
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 490 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 302 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 692 highly variable genes using 1 batches. Selecting top 130
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 922
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
84455108
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
27476501
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
39380073
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
5771255
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
71049308
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
19338798
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
17653656
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
67341804
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
9806823
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
23741531
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
86619186
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
78436088
Strategy duration : 141.9889359474182 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
68305778
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
5006027
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
67844772
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
11894226
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
89756965
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
80564498
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
95628929
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
18800544
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
24231338
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
77136993
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
8085632
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
50273323
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
96770095
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
84165763
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
37797355
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
24822998
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
5996322
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
46626663
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
94364929
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
60770416
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
144386
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
635147
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
59308433
Early stopping at epoch 13, restoring model parameters from this epoch
Strategy duration : 133.50885820388794 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.532081752952782
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-369/metadata
[INFO 04-03 11:06:21] ax.service.ax_client: Completed trial 7 with data: {'opt_metric': (0.532082, None)}.
[INFO 04-03 11:06:21] ax.service.ax_client: Generated new trial 8 with parameters {'use_hvg': 753, 'batch_size': 301, 'clas_w': 15.841592, 'dann_w': 1.999508, 'learning_rate': 0.00011, 'weight_decay': 5.3e-05, 'warmup_epoch': 15, 'dropout': 0.498364, 'bottleneck': 60, 'layer2': 467, 'layer1': 1889} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-370
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scanpy/preprocessing/_normalization.py:233: UserWarning: Some cells have zero counts
  warn(UserWarning("Some cells have zero counts"))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 385 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 251 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 602 highly variable genes using 1 batches. Selecting top 117
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 753
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
88221359
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
94786071
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
27583122
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
9111785
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
15021896
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
7833099
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
18298721
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
58978843
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
65892028
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
60612487
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
42300033
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
6970214
Strategy duration : 76.22493004798889 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
14756011
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
92572784
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
82325553
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
94229888
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
53470039
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
69458389
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
36103820
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
81788825
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
2987670
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
61558532
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
4393959
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
43525505
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
35113525
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
66999816
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
80351257
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
56830596
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
39561080
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
82088470
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
82769775
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
96154403
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
53188514
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
26566886
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
65076828
Epoch 36/62, Current strat Epoch 24/50
Step - Switching permutation
Step - Switching permutation
56675529
Epoch 37/62, Current strat Epoch 25/50
Step - Switching permutation
Step - Switching permutation
85927963
Epoch 38/62, Current strat Epoch 26/50
Step - Switching permutation
Step - Switching permutation
62940216
Epoch 39/62, Current strat Epoch 27/50
Step - Switching permutation
Step - Switching permutation
13994216
Epoch 40/62, Current strat Epoch 28/50
Step - Switching permutation
Step - Switching permutation
35391998
Epoch 41/62, Current strat Epoch 29/50
Step - Switching permutation
Step - Switching permutation
21583747
Epoch 42/62, Current strat Epoch 30/50
Step - Switching permutation
Step - Switching permutation
52910995
Epoch 43/62, Current strat Epoch 31/50
Step - Switching permutation
Step - Switching permutation
59273910
Epoch 44/62, Current strat Epoch 32/50
Step - Switching permutation
Step - Switching permutation
32096862
Epoch 45/62, Current strat Epoch 33/50
Step - Switching permutation
Step - Switching permutation
26692008
Epoch 46/62, Current strat Epoch 34/50
Step - Switching permutation
Step - Switching permutation
10974884
Epoch 47/62, Current strat Epoch 35/50
Step - Switching permutation
Step - Switching permutation
38838005
Epoch 48/62, Current strat Epoch 36/50
Step - Switching permutation
Step - Switching permutation
66952133
Epoch 49/62, Current strat Epoch 37/50
Step - Switching permutation
Step - Switching permutation
72088241
Epoch 50/62, Current strat Epoch 38/50
Step - Switching permutation
Step - Switching permutation
98857116
Epoch 51/62, Current strat Epoch 39/50
Step - Switching permutation
Step - Switching permutation
7317733
Epoch 52/62, Current strat Epoch 40/50
Step - Switching permutation
Step - Switching permutation
23714065
Early stopping at epoch 30, restoring model parameters from this epoch
Strategy duration : 139.47547578811646 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.5264473448477179
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 11 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 11 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-370/metadata
[INFO 04-03 11:10:27] ax.service.ax_client: Completed trial 8 with data: {'opt_metric': (0.526447, None)}.
[INFO 04-03 11:10:27] ax.service.ax_client: Generated new trial 9 with parameters {'use_hvg': 956, 'batch_size': 122, 'clas_w': 59.174601, 'dann_w': 0.000343, 'learning_rate': 0.006555, 'weight_decay': 0.0, 'warmup_epoch': 16, 'dropout': 0.322209, 'bottleneck': 59, 'layer2': 70, 'layer1': 928} using model Sobol.
[neptune] [info   ] Neptune initialized. Open in the app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-371
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/scpermut/workflow/dataset.py:331: ImplicitModificationWarning: Trying to modify attribute `.obs` of view, initializing view as actual.
  self.adata_train_extended.obs['train_split'] = to_keep
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/keras/src/optimizers/base_optimizer.py:576: UserWarning: Gradients do not exist for variables ['kernel', 'bias', 'gamma', 'beta', 'kernel', 'bias'] when minimizing the loss. If using `model.compile()`, did you forget to provide a `loss` argument?
  warnings.warn(
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/lib/function_base.py:520: RuntimeWarning: Mean of empty slice.
  avg = a.mean(axis, **keepdims_kw)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/fromnumeric.py:3504: RuntimeWarning: Mean of empty slice.
  return _methods._mean(a, axis=axis, dtype=dtype,
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/numpy/core/_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:708: RuntimeWarning: invalid value encountered in scalar divide
  k = np.sum(w_mat * confusion) / np.sum(w_mat * expected)
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/data/analysis/ML_models/conda_env/sc_permut_2/lib/python3.11/site-packages/sklearn/metrics/_classification.py:2458: UserWarning: y_pred contains classes not in y_true
  warnings.warn("y_pred contains classes not in y_true")
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
/home/becavin/scPermut/scpermut/tools/clust_compute.py:311: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`
  weights = np.array(y_true_s.replace(ct_weights))
dataset loaded at /data/analysis/data_becavin/scpermut_test//data/tran_2021.h5ad
Searching for highly variable genes in 3 batches
Found 515 highly variable genes using 3 batches
Searching for highly variable genes in 2 batches
Found 301 highly variable genes using 2 batches
Searching for highly variable genes in 1 batches
Found 721 highly variable genes using 1 batches. Selecting top 140
test obs :['donor1']
splitting this adata train/val : View of AnnData object with n_obs × n_vars = 5754 × 956
    obs: 'Dataset', 'donor_id', 'development_stage', 'sex', 'suspension_type', 'assay', 'Original_annotation', 'CellHint_harmonised_group', 'cell_type', 'Curated_annotation', 'organism', 'disease', 'tissue', 'batch', 'Original_annotation_batch', 'TRAIN_TEST_split', 'TRAIN_TEST_split_batch', 'n_genes', 'true_Original_annotation', 'n_counts', 'size_factors'
    var: 'exist_in_Ayhan2021', 'exist_in_Franjic2022', 'exist_in_Tran2021', 'exist_in_Siletti2022', 'n_cells', 'n_counts'
    uns: 'Curated_annotation_colors', 'Original_annotation_colors', 'donor_id_colors', 'schema_version', 'title', 'log1p'
    obsm: 'X_uce', 'X_umap'
train, test, val proportions : train_split
test     4313
train    3909
val      1845
Name: count, dtype: int64
dataset has been preprocessed
Step number 0, running warmup_dann strategy with permutation = False for 12 epochs
Epoch 1/62, Current strat Epoch 1/12
Step - Switching permutation
Step - Switching permutation
77069854
Epoch 2/62, Current strat Epoch 2/12
Step - Switching permutation
Step - Switching permutation
82344818
Epoch 3/62, Current strat Epoch 3/12
Step - Switching permutation
Step - Switching permutation
71957778
Epoch 4/62, Current strat Epoch 4/12
Step - Switching permutation
Step - Switching permutation
91930770
Epoch 5/62, Current strat Epoch 5/12
Step - Switching permutation
Step - Switching permutation
33876037
Epoch 6/62, Current strat Epoch 6/12
Step - Switching permutation
Step - Switching permutation
69776535
Epoch 7/62, Current strat Epoch 7/12
Step - Switching permutation
Step - Switching permutation
92088508
Epoch 8/62, Current strat Epoch 8/12
Step - Switching permutation
Step - Switching permutation
70262527
Epoch 9/62, Current strat Epoch 9/12
Step - Switching permutation
Step - Switching permutation
42183113
Epoch 10/62, Current strat Epoch 10/12
Step - Switching permutation
Step - Switching permutation
15419197
Epoch 11/62, Current strat Epoch 11/12
Step - Switching permutation
Step - Switching permutation
92070960
Epoch 12/62, Current strat Epoch 12/12
Step - Switching permutation
Step - Switching permutation
92206954
Strategy duration : 164.6393473148346 s
Step number 0, running full_model strategy with permutation = False for 50 epochs
Epoch 13/62, Current strat Epoch 1/50
Step - Switching permutation
Step - Switching permutation
14801406
Epoch 14/62, Current strat Epoch 2/50
Step - Switching permutation
Step - Switching permutation
46325302
Epoch 15/62, Current strat Epoch 3/50
Step - Switching permutation
Step - Switching permutation
1011276
Epoch 16/62, Current strat Epoch 4/50
Step - Switching permutation
Step - Switching permutation
44472694
Epoch 17/62, Current strat Epoch 5/50
Step - Switching permutation
Step - Switching permutation
85852241
Epoch 18/62, Current strat Epoch 6/50
Step - Switching permutation
Step - Switching permutation
20052909
Epoch 19/62, Current strat Epoch 7/50
Step - Switching permutation
Step - Switching permutation
54745101
Epoch 20/62, Current strat Epoch 8/50
Step - Switching permutation
Step - Switching permutation
62416076
Epoch 21/62, Current strat Epoch 9/50
Step - Switching permutation
Step - Switching permutation
20100402
Epoch 22/62, Current strat Epoch 10/50
Step - Switching permutation
Step - Switching permutation
54853057
Epoch 23/62, Current strat Epoch 11/50
Step - Switching permutation
Step - Switching permutation
36889457
Epoch 24/62, Current strat Epoch 12/50
Step - Switching permutation
Step - Switching permutation
89886474
Epoch 25/62, Current strat Epoch 13/50
Step - Switching permutation
Step - Switching permutation
15062332
Epoch 26/62, Current strat Epoch 14/50
Step - Switching permutation
Step - Switching permutation
28743934
Epoch 27/62, Current strat Epoch 15/50
Step - Switching permutation
Step - Switching permutation
88418006
Epoch 28/62, Current strat Epoch 16/50
Step - Switching permutation
Step - Switching permutation
97836494
Epoch 29/62, Current strat Epoch 17/50
Step - Switching permutation
Step - Switching permutation
31365585
Epoch 30/62, Current strat Epoch 18/50
Step - Switching permutation
Step - Switching permutation
99219703
Epoch 31/62, Current strat Epoch 19/50
Step - Switching permutation
Step - Switching permutation
42295837
Epoch 32/62, Current strat Epoch 20/50
Step - Switching permutation
Step - Switching permutation
19545745
Epoch 33/62, Current strat Epoch 21/50
Step - Switching permutation
Step - Switching permutation
74418258
Epoch 34/62, Current strat Epoch 22/50
Step - Switching permutation
Step - Switching permutation
49845504
Epoch 35/62, Current strat Epoch 23/50
Step - Switching permutation
Step - Switching permutation
20213890
Early stopping at epoch 13, restoring model parameters from this epoch
Strategy duration : 162.35825514793396 s
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
Computing neighborhood graph
[0.42842952 0.3882984  0.18327208]
Entropy mixing ----- step 0
Entropy mixing ----- step 10
Entropy mixing ----- step 20
Entropy mixing ----- step 30
Entropy mixing ----- step 40
Entropy mixing ----- step 50
Entropy mixing ----- step 60
Entropy mixing ----- step 70
Entropy mixing ----- step 80
Entropy mixing ----- step 90
<class 'numpy.float64'>
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (13, 13)
label : (13, 13)
label df : (13, 13)
no label : (14, 14)
label : (14, 14)
label df : (14, 14)
opt_metric 0.8363898796208279
[neptune] [info   ] Shutting down background jobs, please wait a moment...
[neptune] [info   ] Done!
[neptune] [info   ] Waiting for the remaining 8 operations to synchronize with Neptune. Do not kill this process.
[neptune] [info   ] All 8 operations synced, thanks for waiting!
[neptune] [info   ] Explore the metadata in the Neptune app: https://app.neptune.ai/becavin-lab/sc-permut-packaging/e/SCPERP1-371/metadata
[INFO 04-03 11:16:24] ax.service.ax_client: Completed trial 9 with data: {'opt_metric': (0.83639, None)}.
{'use_hvg': 956, 'batch_size': 122, 'clas_w': 59.17460144575316, 'dann_w': 0.0003428858027936653, 'learning_rate': 0.006554556660590522, 'weight_decay': 1.7406572410031228e-07, 'warmup_epoch': 16, 'dropout': 0.32220904901623726, 'bottleneck': 59, 'layer2': 70, 'layer1': 928}
